name: '[CI] Continuous Integration'

on:
    workflow_dispatch:
    schedule:
        - cron: '0 0 * * *' # Runs every day at midnight UTC

permissions:
    contents: write

jobs:
    chore-dependencies:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v3
              with:
                  ref: dev

            - name: Set up Node.js
              uses: actions/setup-node@v3
              with:
                  node-version: '16'

            - name: Install dependencies
              run: |
                  npm install

            - name: Update dependencies
              run: |
                  npx npm-check-updates -u
                  npm install

            - name: Commit and push changes
              run: |
                  git config user.name "GitHub Actions"
                  git config user.email "github-actions@users.noreply.github.com"
                  git add package.json package-lock.json
                  if ! git diff --cached --quiet; then
                    git commit -m "chore: update dependencies"
                    git push origin HEAD:dev
                  else
                    echo "No changes to commitüëçüëç"
                  fi

    chore-prettier:
        runs-on: ubuntu-latest
        needs: chore-dependencies

        steps:
            - name: Checkout repository
              uses: actions/checkout@v3
              with:
                  ref: dev

            - name: Install Prettier
              run: |
                  npm install -g prettier

            - name: Format JSON files using Prettier
              run: |
                  prettier --write . --ignore-path .prettierignore

            - name: Commit and push changes
              run: |
                  git config user.name "GitHub Actions"
                  git config user.email "github-actions@users.noreply.github.com"
                  git add -A
                  if ! git diff --cached --quiet; then
                    git commit -m "chore: format files with prettier"
                    git push origin HEAD:dev
                  else
                    echo "No changes to commitüëçüëç"
                  fi
